# =====================================================
# VARIABLES DE AMBIENTE - DESARROLLO
# =====================================================
# Simula Azure DevOps Library Group: "eks-controllers-dev"

# =====================================================
# CONFIGURACIÓN DEL CLUSTER
# =====================================================
CLUSTER_NAME="${cluster_name}"
AWS_REGION="${aws_region}"
AWS_ACCOUNT_ID="${aws_account_id}"

# VPC ID del cluster (requerido para Fargate o nodos con IMDS restringido)
# Obtener con: aws eks describe-cluster --name CLUSTER_NAME --query "cluster.resourcesVpcConfig.vpcId" --output text
VPC_ID="${vpc_id}"

# =====================================================
# KARPENTER - NODECLASS CONFIGURATION
# =====================================================
NODECLASS_ENABLED="${nodeclass_enabled}"
NODECLASS_NAME_OVERRIDE="${nodeclass_name_override}"
NODECLASS_ROLE="${nodeclass_role}"

# Subnets para nodos (separados por comas)
NODECLASS_SUBNET_IDS="${nodeclass_subnet_ids}"

# Security group del cluster EKS (separados por comas)  
NODECLASS_SG_IDS="${nodeclass_sg_ids}"

NODECLASS_EPHEMERAL_SIZE="${nodeclass_ephemeral_size}"
NODECLASS_EPHEMERAL_IOPS="${nodeclass_ephemeral_iops}"
NODECLASS_EPHEMERAL_THROUGHPUT="${nodeclass_ephemeral_throughput}"
NODECLASS_SNAT_POLICY="${nodeclass_snat_policy}"
NODECLASS_NETWORK_POLICY="${nodeclass_network_policy}"
NODECLASS_NETWORK_POLICY_LOGS="${nodeclass_network_policy_logs}"

# Tags adicionales (formato: key1=value1,key2=value2)
NODECLASS_TAGS="${nodeclass_tags}"

# =====================================================
# KARPENTER - NODEPOOL CONFIGURATION
# =====================================================
NODEPOOL_ENABLED="${nodepool_enabled}"
NODEPOOL_NAME_OVERRIDE="${nodepool_name_override}"
NODEPOOL_NODECLASS_REF="${nodepool_nodeclass_ref}"

# Tipos de instancias permitidas (separados por comas)
NODEPOOL_INSTANCE_CATEGORIES="${nodepool_instance_categories}"
NODEPOOL_ZONES="${nodepool_zones}"
NODEPOOL_ARCHITECTURES="${nodepool_architectures}"
NODEPOOL_CAPACITY_TYPES="${nodepool_capacity_types}"

NODEPOOL_EXPIRE_AFTER="${nodepool_expire_after}"
NODEPOOL_TERMINATION_GRACE_PERIOD="${nodepool_termination_grace_period}"
NODEPOOL_CONSOLIDATION_POLICY="${nodepool_consolidation_policy}"
NODEPOOL_CONSOLIDATE_AFTER="${nodepool_consolidate_after}"
NODEPOOL_CPU_LIMIT="${nodepool_cpu_limit}"
NODEPOOL_MEMORY_LIMIT="${nodepool_memory_limit}"
NODEPOOL_WEIGHT="${nodepool_weight}"

# =====================================================

# =====================================================
# AWS LOAD BALANCER CONTROLLER
# =====================================================
# Habilitar/Deshabilitar el controlador
LB_CONTROLLER_ENABLED="${lb_controller_enabled}"

# Nombre personalizado - Este será el nombre base de los pods
# Ejemplo: "aws-load-balancer-controller" → pods: aws-load-balancer-controller-xxxxx-xxxxx
LB_CONTROLLER_NAME_OVERRIDE="${lb_controller_name_override}"

# IAM Role ARN para IRSA
LB_CONTROLLER_ROLE_ARN="${lb_controller_role_arn}"

# Recursos (conservadores para dev)
LB_CONTROLLER_REPLICAS="${lb_controller_replicas}"
LB_CONTROLLER_CPU_REQUEST="${lb_controller_cpu_request}"
LB_CONTROLLER_MEMORY_REQUEST="${lb_controller_memory_request}"
LB_CONTROLLER_CPU_LIMIT="${lb_controller_cpu_limit}"
LB_CONTROLLER_MEMORY_LIMIT="${lb_controller_memory_limit}"

# Configuraciones adicionales importantes
LB_CONTROLLER_LOG_LEVEL="${lb_controller_log_level}"  # debug, info, warn, error
LB_CONTROLLER_ENABLE_SHIELD="${lb_controller_enable_shield}"  # Habilitar AWS Shield Advanced
LB_CONTROLLER_ENABLE_WAF="${lb_controller_enable_waf}"     # Habilitar AWS WAF
LB_CONTROLLER_DEFAULT_TAGS="${lb_controller_default_tags}"  # Tags por defecto para ALBs/NLBs

# =====================================================
# CLUSTER AUTOSCALER
# =====================================================
# Habilitar/Deshabilitar el autoscaler
CLUSTER_AUTOSCALER_ENABLED="${cluster_autoscaler_enabled}"  # Deshabilitado en dev para ahorrar costos

# Nombre personalizado - Este será el nombre base de los pods
# Ejemplo: "cluster-autoscaler" → pods: cluster-autoscaler-xxxxx-xxxxx
CLUSTER_AUTOSCALER_NAME_OVERRIDE="${cluster_autoscaler_name_override}"

# IAM Role ARN para IRSA
CLUSTER_AUTOSCALER_ROLE_ARN="${cluster_autoscaler_role_arn}"

# Recursos (conservadores para dev)
CLUSTER_AUTOSCALER_REPLICAS="${cluster_autoscaler_replicas}"
CLUSTER_AUTOSCALER_CPU_REQUEST="${cluster_autoscaler_cpu_request}"
CLUSTER_AUTOSCALER_MEMORY_REQUEST="${cluster_autoscaler_memory_request}"
CLUSTER_AUTOSCALER_CPU_LIMIT="${cluster_autoscaler_cpu_limit}"
CLUSTER_AUTOSCALER_MEMORY_LIMIT="${cluster_autoscaler_memory_limit}"

# Configuración del Cluster Autoscaler
CA_SKIP_NODES_WITH_LOCAL_STORAGE="${ca_skip_nodes_with_local_storage}"
CA_EXPANDER="${ca_expander}"
CA_BALANCE_SIMILAR_NODE_GROUPS="${ca_balance_similar_node_groups}"
CA_SKIP_NODES_WITH_SYSTEM_PODS="${ca_skip_nodes_with_system_pods}"

# Configuraciones adicionales importantes
CA_SCALE_DOWN_ENABLED="${ca_scale_down_enabled}"           # Permitir reducir nodos
CA_SCALE_DOWN_DELAY_AFTER_ADD="${ca_scale_down_delay_after_add}"    # Esperar antes de reducir después de agregar
CA_SCALE_DOWN_UNNEEDED_TIME="${ca_scale_down_unneeded_time}"      # Tiempo que un nodo debe estar sin usar
CA_SCALE_DOWN_UTILIZATION_THRESHOLD="${ca_scale_down_utilization_threshold}"  # Umbral de utilización para reducir (50%)
CA_MAX_NODE_PROVISION_TIME="${ca_max_node_provision_time}"       # Tiempo máximo para provisionar un nodo
CA_LOG_LEVEL="${ca_log_level}"                       # Nivel de logs (1-10, 4=info, 6=debug)
