# =============================================================================
# CONFIGURACI√ìN PARA INSTALACI√ìN DE CONTROLADORES DE INGRESS
# =============================================================================
# Este archivo contiene todas las variables necesarias para instalar
# AWS Load Balancer Controller y NGINX Ingress Controller en Amazon EKS
#
# INSTRUCCIONES:
# 1. Edita los valores seg√∫n tu entorno
# 2. Las variables marcadas como OBLIGATORIAS deben tener valores
# 3. Las variables OPCIONALES pueden dejarse vac√≠as para usar valores por defecto
# =============================================================================

# -----------------------------------------------------------------------------
# üéØ SWITCHES DE INSTALACI√ìN (CONFIGURAR PRIMERO)
# -----------------------------------------------------------------------------

# Instalar AWS Load Balancer Controller
# VALORES: "true" o "false"
export INSTALL_AWS_LB_CONTROLLER="true"

# Instalar NGINX Ingress Controller  
# VALORES: "true" o "false"
export INSTALL_NGINX_CONTROLLER="true"

# Instalar Cluster Autoscaler
# VALORES: "true" o "false"
export INSTALL_CLUSTER_AUTOSCALER="false"

# Instalar NodeClass y NodePool (EKS Auto Mode)
# VALORES: "true" o "false"
export INSTALL_NODECLASS_NODEPOOL="true"

# -----------------------------------------------------------------------------
# üèóÔ∏è CONFIGURACI√ìN DE NODECLASS Y NODEPOOL (EKS AUTO MODE)
# -----------------------------------------------------------------------------

# Nombre del NodeClass
export NODECLASS_NAME="test-customize"

# Nombre del NodePool
export NODEPOOL_NAME="my-node-pool"

# Rol IAM para los nodos (sin arn, solo el nombre)
export NODE_ROLE_NAME="ban-xrs-creditoffer-eks-cluster-poc-auto-mode-node-role"

# Tama√±o del almacenamiento ef√≠mero
export EPHEMERAL_STORAGE_SIZE="20Gi"

# Etiqueta del equipo de facturaci√≥n
export BILLING_TEAM="CloudOps"

# Nombre para las instancias EC2
export INSTANCE_NAME="ban-xrs-ic-ec2-instance-dev"

# Familias de instancia espec√≠ficas (separadas por comas)
export INSTANCE_FAMILIES="m5,m6i,c5,c6i,r5,r6i"

# Zonas de disponibilidad (separadas por comas)
export AVAILABILITY_ZONES="us-east-1a,us-east-1b"

# Arquitectura
export NODE_ARCHITECTURE="amd64"

# Tipo de capacidad (on-demand o spot)
export CAPACITY_TYPE="on-demand"

# L√≠mites del NodePool
export CPU_LIMIT="1000"
export MEMORY_LIMIT="1000Gi"

# -----------------------------------------------------------------------------
# üèóÔ∏è CONFIGURACI√ìN B√ÅSICA DEL CLUSTER (OBLIGATORIAS)
# -----------------------------------------------------------------------------

# Nombre del cluster EKS donde se instalar√°n los controladores
# Ejemplo: "mi-cluster-produccion", "dev-cluster"
export CLUSTER_NAME="ban-xrs-creditoffer-eks-cluster-poc"

# Regi√≥n AWS donde est√° ubicado el cluster EKS
# Ejemplos: "us-east-1", "us-west-2", "eu-west-1"
export AWS_REGION="us-east-1"

# ID de la cuenta AWS (12 d√≠gitos)
# Se usa para crear pol√≠ticas IAM y roles
# Obtener con: aws sts get-caller-identity --query Account --output text
export AWS_ACCOUNT_ID="161156235207"

# ID de la VPC donde est√° el cluster EKS
# Se usa para buscar subnets y security groups autom√°ticamente
# Obtener con: aws eks describe-cluster --name CLUSTER_NAME --query cluster.resourcesVpcConfig.vpcId
export VPC_ID="vpc-0c75a54998a50fe08"



# -----------------------------------------------------------------------------
# üåê CONFIGURACI√ìN DE RED
# -----------------------------------------------------------------------------

# Subnets p√∫blicas (separadas por comas)
# OPCIONAL: Dejar vac√≠o para selecci√≥n autom√°tica
# Usar para Load Balancers internet-facing
# Ejemplo: "subnet-abc123,subnet-def456"
export PUBLIC_SUBNETS="subnet-05d84f7334351707d,subnet-0f3f227bf490bb731"

# Subnets privadas (separadas por comas)
# OPCIONAL: Dejar vac√≠o para selecci√≥n autom√°tica
# Usar para Load Balancers internos
# Ejemplo: "subnet-ghi789,subnet-jkl012"
export PRIVATE_SUBNETS=""

# Tipo de subnets a usar para el Load Balancer
# VALORES: "public" (internet-facing) o "private" (internal)
# - public: Load Balancer accesible desde internet
# - private: Load Balancer solo accesible desde la VPC
export SUBNET_TYPE="public"

# Security Group personalizado para el Load Balancer
# OPCIONAL: Se combinar√° autom√°ticamente con el security group del cluster EKS
# El script busca autom√°ticamente el security group del cluster
# Ejemplo: "sg-0a1b2c3d4e5f6g7h8"
export INGRESS_SECURITY_GROUP="sg-0dfffe8a742937f9b"

# -----------------------------------------------------------------------------
# üîê CONFIGURACI√ìN DE SEGURIDAD Y CERTIFICADOS
# -----------------------------------------------------------------------------

# Certificado SSL/TLS de AWS Certificate Manager
# OPCIONAL: Dejar vac√≠o para usar solo HTTP
# ARN completo del certificado ACM
# Ejemplo: "arn:aws:acm:us-east-1:123456789012:certificate/12345678-1234-1234-1234-123456789012"
# Obtener con: aws acm list-certificates --region REGION
export ACM_CERTIFICATE_ARN=""

# -----------------------------------------------------------------------------
# ‚öôÔ∏è CONFIGURACI√ìN DEL AWS LOAD BALANCER CONTROLLER
# -----------------------------------------------------------------------------

# Crear IAM Role autom√°ticamente para AWS LB Controller
# VALORES: "true" o "false"
# Si es "false", debe existir el role: AmazonEKSLoadBalancerControllerRole
export CREATE_IAM_ROLE="true"

# Crear IAM Policy autom√°ticamente
# VALORES: "true" o "false"  
# Si es "false", debe existir la policy: AWSLoadBalancerControllerIAMPolicy
export CREATE_IAM_POLICY="true"

# Crear Service Account autom√°ticamente
# VALORES: "true" o "false"
# Si es "false", debe existir: aws-load-balancer-controller en kube-system
export CREATE_SERVICE_ACCOUNT="true"

# Versi√≥n del AWS Load Balancer Controller
# Usar versi√≥n espec√≠fica para entornos de producci√≥n (buena pr√°ctica)
# Verificar versiones en: https://github.com/kubernetes-sigs/aws-load-balancer-controller/releases
# NOTA: Esta es la versi√≥n del CHART de Helm, no la versi√≥n de la aplicaci√≥n
export AWS_LB_CONTROLLER_VERSION="1.13.2"

# -----------------------------------------------------------------------------
# üöÄ CONFIGURACI√ìN DEL NGINX INGRESS CONTROLLER
# -----------------------------------------------------------------------------

# Namespace donde se instalar√° NGINX Ingress Controller
# Se crear√° autom√°ticamente si no existe
# Recomendado: "ingress-nginx" (est√°ndar) o nombre personalizado, no colocar kube-system
export NGINX_NAMESPACE="nginx-ns"

# Nombre del Network Load Balancer que crear√° NGINX
# Debe ser √∫nico en tu cuenta AWS
# M√°ximo 32 caracteres, solo letras, n√∫meros y guiones
export NLB_NAME="balanceador-nginx-nlb"

# Tipo de target para el Load Balancer
# VALORES: "ip" o "instance"
# - ip: Recomendado para Fargate y mejor rendimiento
# - instance: Para nodos EC2 tradicionales
export TARGET_TYPE="ip"

# Versi√≥n del NGINX Ingress Controller
# Usar versi√≥n espec√≠fica para entornos de producci√≥n
# Verificar versiones en: https://github.com/kubernetes/ingress-nginx/releases
export NGINX_CONTROLLER_VERSION="4.12.7"

# -----------------------------------------------------------------------------
# üìà CONFIGURACI√ìN DEL CLUSTER AUTOSCALER
# -----------------------------------------------------------------------------

# Tipo de instancia de los nodos EC2
# Ejemplo: "t3.medium", "t3.large", "t3.xlarge", "m5.large"
export NODE_INSTANCE_TYPE="t3.xlarge"

# L√≠mites de escalado autom√°tico
# M√≠nimo n√∫mero de nodos en el cluster
export MIN_NODES="2"

# M√°ximo n√∫mero de nodos en el cluster
export MAX_NODES="10"

# Versi√≥n del Cluster Autoscaler
# Debe coincidir con la versi√≥n de Kubernetes del cluster
# Verificar versiones en: https://github.com/kubernetes/autoscaler/releases
export CLUSTER_AUTOSCALER_VERSION="1.33.0"

# Configuraci√≥n de escalado
# Tiempo en segundos antes de escalar hacia abajo nodos no utilizados
export SCALE_DOWN_DELAY_AFTER_ADD="10m"

# Tiempo en segundos antes de escalar hacia abajo despu√©s de eliminar un nodo
export SCALE_DOWN_UNNEEDED_TIME="10m"

# Umbral de utilizaci√≥n para considerar un nodo como no necesario (0.5 = 50%)
export SCALE_DOWN_UTILIZATION_THRESHOLD="0.5"

# =============================================================================
# üìã NOTAS IMPORTANTES Y COMANDOS √öTILES
# =============================================================================
# 
# üîí SEGURIDAD:
#    - Los security groups se combinan autom√°ticamente
#    - Se crean roles IAM con permisos m√≠nimos necesarios
#    - Los certificados ACM proporcionan cifrado TLS
#
# üí∞ COSTOS:
#    - Network Load Balancer: ~$16-45/mes
#    - Application Load Balancer: ~$16-22/mes  
#    - Data Processing: $0.006-0.008 por GB
#    - t3.xlarge: ~$0.1664/hora (~$120/mes por nodo)
#    - Cluster Autoscaler: Gratis (solo pagas por los nodos que usa)
#
# üìä L√çMITES AWS:
#    - M√°ximo 50 Load Balancers por regi√≥n
#    - M√°ximo 1000 Target Groups por regi√≥n
#    - Verificar l√≠mites en AWS Service Quotas
#
# üîß TROUBLESHOOTING:
#    - Ejecutar ./verify-installation.sh para diagn√≥sticos
#    - Revisar logs: kubectl logs -n kube-system deployment/aws-load-balancer-controller
#    - Verificar eventos: kubectl get events --sort-by='.lastTimestamp'
#
# üí° COMANDOS √öTILES:
#    - Obtener Account ID: aws sts get-caller-identity --query Account --output text
#    - Obtener VPC ID: aws eks describe-cluster --name CLUSTER_NAME --query cluster.resourcesVpcConfig.vpcId
#    - Listar subnets: aws ec2 describe-subnets --filters "Name=vpc-id,Values=VPC_ID" --query 'Subnets[*].[SubnetId,AvailabilityZone,MapPublicIpOnLaunch]'
#    - Listar certificados: aws acm list-certificates --region REGION
#    - Verificar perfiles: aws configure list-profiles
#
# =============================================================================
