# =============================================================================
# CONFIGURACI√ìN PARA INSTALACI√ìN DE CONTROLADORES DE INGRESS
# =============================================================================
# Este archivo contiene todas las variables necesarias para instalar
# AWS Load Balancer Controller y NGINX Ingress Controller en Amazon EKS
#
# INSTRUCCIONES:
# 1. Edita los valores seg√∫n tu entorno
# 2. Las variables marcadas como OBLIGATORIAS deben tener valores
# 3. Las variables OPCIONALES pueden dejarse vac√≠as para usar valores por defecto
# =============================================================================

# -----------------------------------------------------------------------------
# üéØ SWITCHES DE INSTALACI√ìN (CONFIGURAR PRIMERO)
# -----------------------------------------------------------------------------

# Instalar AWS Load Balancer Controller
# VALORES: "true" o "false"
export INSTALL_AWS_LB_CONTROLLER="false"

# Instalar NGINX Ingress Controller  
# VALORES: "true" o "false"
export INSTALL_NGINX_CONTROLLER="false"

# Instalar NodeClass y NodePool (EKS Auto Mode)
# VALORES: "true" o "false"
export INSTALL_NODECLASS_NODEPOOL="true"

# -----------------------------------------------------------------------------
# üèóÔ∏è CONFIGURACI√ìN DE NODECLASS Y NODEPOOL (EKS AUTO MODE)
# -----------------------------------------------------------------------------

# Nombre del NodeClass
export NODECLASS_NAME="dev-nodeclass"

# Nombre del NodePool
export NODEPOOL_NAME="dev-nodepool"

# Rol IAM para los nodos (sin arn, solo el nombre)
export NODE_ROLE_NAME="Harrinson-Auto-Mode"

# Tag para seleccionar Security Groups de nodos
export SECURITY_GROUP_TAG_VALUE="1"

# Tama√±o del almacenamiento ef√≠mero
export EPHEMERAL_STORAGE_SIZE="80Gi"

# Etiqueta del equipo de facturaci√≥n
export BILLING_TEAM="platform"

# Nombre para las instancias EC2
export INSTANCE_NAME="eks-worker-dev"

# Familias de instancia espec√≠ficas (separadas por comas)
export INSTANCE_FAMILIES="c,m,r"

# Zonas de disponibilidad (separadas por comas)
export AVAILABILITY_ZONES="us-east-1a,us-east-1b,us-east-1c"

# Arquitectura
export NODE_ARCHITECTURE="amd64"

# Sistema operativo (linux o windows)
export NODE_OS="linux"

# Tipo de capacidad (on-demand o spot)
export CAPACITY_TYPE="spot"

# Etiqueta personalizada para identificar nodos de Karpenter
export CUSTOM_LABEL_KEY="nodepool"
export CUSTOM_LABEL_VALUE="dev"

# Pol√≠tica de consolidaci√≥n de nodos
export CONSOLIDATION_POLICY="WhenEmptyOrUnderutilized"

# Tiempo de espera antes de consolidar nodos
export CONSOLIDATE_AFTER="30s"

# Presupuesto de disrupci√≥n
export DISRUPTION_BUDGET="50%"

# L√≠mites del NodePool
export CPU_LIMIT="16"
export MEMORY_LIMIT="64Gi"

# -----------------------------------------------------------------------------
# üèóÔ∏è CONFIGURACI√ìN B√ÅSICA DEL CLUSTER (OBLIGATORIAS)
# -----------------------------------------------------------------------------

# Nombre del cluster EKS donde se instalar√°n los controladores
export CLUSTER_NAME="Harrinson"

# Regi√≥n AWS donde est√° ubicado el cluster EKS
export AWS_REGION="us-east-1"

# ID de la cuenta AWS (12 d√≠gitos)
export AWS_ACCOUNT_ID="161156235207"

# ID de la VPC donde est√° el cluster EKS
export VPC_ID="vpc-0415f169c631ee4d0"

# -----------------------------------------------------------------------------
# üåê CONFIGURACI√ìN DE RED
# -----------------------------------------------------------------------------

# Subnets p√∫blicas (separadas por comas)
# OPCIONAL: Dejar vac√≠o para selecci√≥n autom√°tica
# Usar para Load Balancers internet-facing
# Ejemplo: "subnet-abc123,subnet-def456"
#export PUBLIC_SUBNETS="${public-subnets}"
export PUBLIC_SUBNETS="${public-subnets}"

# Subnets privadas (separadas por comas)
# OPCIONAL: Dejar vac√≠o para selecci√≥n autom√°tica
# Usar para Load Balancers internos
# Ejemplo: "subnet-ghi789,subnet-jkl012"
export PRIVATE_SUBNETS=""

# Tipo de subnets a usar para el Load Balancer
# VALORES: "public" (internet-facing) o "private" (internal)
# - public: Load Balancer accesible desde internet
# - private: Load Balancer solo accesible desde la VPC
export SUBNET_TYPE="${subnet-type}"

# Security Group personalizado para el Load Balancer
# OPCIONAL: Se combinar√° autom√°ticamente con el security group del cluster EKS
# El script busca autom√°ticamente el security group del cluster
# Ejemplo: "sg-0a1b2c3d4e5f6g7h8"
#export INGRESS_SECURITY_GROUP="${ingress-security-group}"
export INGRESS_SECURITY_GROUP="${ingress-security-group}"

# -----------------------------------------------------------------------------
# üîê CONFIGURACI√ìN DE SEGURIDAD Y CERTIFICADOS
# -----------------------------------------------------------------------------

# Certificado SSL/TLS de AWS Certificate Manager
# OPCIONAL: Dejar vac√≠o para usar solo HTTP
# ARN completo del certificado ACM
# Ejemplo: "arn:aws:acm:us-east-1:123456789012:certificate/12345678-1234-1234-1234-123456789012"
# Obtener con: aws acm list-certificates --region REGION
export ACM_CERTIFICATE_ARN="${acm-certificate-arn}"

# -----------------------------------------------------------------------------
# ‚öôÔ∏è CONFIGURACI√ìN DEL AWS LOAD BALANCER CONTROLLER
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# üè∑Ô∏è CONFIGURACI√ìN DE TAGS PARA INSTANCIAS EC2
# -----------------------------------------------------------------------------

# Tags empresariales para instancias EC2 (se aplican en NodeClass)
export TAG_COST_CENTER="${tag-cost-center}"
export TAG_TRIBU="${tag-tribu}"
export TAG_SQUAD="${tag-squad}"
export TAG_BACKUP="${tag-backup}"
export TAG_COUNTRY="${tag-country}"
export TAG_APPLICATION_NAME="${tag-application-name}"
export TAG_COMPANY="${tag-company}"
export TAG_DISASTER_RECOVERY="${tag-disaster-recovery}"
export TAG_BIA="${tag-bia}"
export TAG_CONFIDENTIALITY="${tag-confidentiality}"
export TAG_INTEGRITY="${tag-integrity}"
export TAG_AVAILABILITY="${tag-availability}"
export TAG_PCI="${tag-pci}"
export TAG_ENVIRONMENT="${tag-environment}"
export TAG_MAP_MIGRATED="${tag-map-migrated}"
export TAG_TFMODULE="${tag-tfmodule}"
export TAG_SCHEDULE="${tag-schedule}"
export TAG_PERSONAL_DATA="${tag-personal-data}"

# -----------------------------------------------------------------------------
# ‚öôÔ∏è CONFIGURACI√ìN DEL AWS LOAD BALANCER CONTROLLER
# -----------------------------------------------------------------------------

# Crear IAM Role autom√°ticamente para AWS LB Controller
# VALORES: "true" o "false"
# Si es "false", debe existir el role: AmazonEKSLoadBalancerControllerRole
export CREATE_IAM_ROLE="${create-iam-role}"

# Crear IAM Policy autom√°ticamente
# VALORES: "true" o "false"  
# Si es "false", debe existir la policy: AWSLoadBalancerControllerIAMPolicy
export CREATE_IAM_POLICY="${create-iam-policy}"

# Crear Service Account autom√°ticamente
# VALORES: "true" o "false"
# Si es "false", debe existir: aws-load-balancer-controller en kube-system
export CREATE_SERVICE_ACCOUNT="${create-service-account}"

# Versi√≥n del AWS Load Balancer Controller
# Usar versi√≥n espec√≠fica para entornos de producci√≥n (buena pr√°ctica)
# Verificar versiones en: https://github.com/kubernetes-sigs/aws-load-balancer-controller/releases
# NOTA: Esta es la versi√≥n del CHART de Helm, no la versi√≥n de la aplicaci√≥n
export AWS_LB_CONTROLLER_VERSION="${aws-lb-controller-version}"

# -----------------------------------------------------------------------------
# üöÄ CONFIGURACI√ìN DEL NGINX INGRESS CONTROLLER
# -----------------------------------------------------------------------------

# Namespace donde se instalar√° NGINX Ingress Controller
# Se crear√° autom√°ticamente si no existe
# Recomendado: "ingress-nginx" (est√°ndar) o nombre personalizado, no colocar kube-system
export NGINX_NAMESPACE="${nginx-namespace}"

# Nombre del Network Load Balancer que crear√° NGINX
# Debe ser √∫nico en tu cuenta AWS
# M√°ximo 32 caracteres, solo letras, n√∫meros y guiones
#export NLB_NAME="balanceador-nginx-nlb"
export NLB_NAME="${nlb-name}"

# Tipo de target para el Load Balancer
# VALORES: "ip" o "instance"
# - ip: Recomendado para Fargate y mejor rendimiento
# - instance: Para nodos EC2 tradicionales
export TARGET_TYPE="${target-type}"

# Versi√≥n del NGINX Ingress Controller
# Usar versi√≥n espec√≠fica para entornos de producci√≥n
# Verificar versiones en: https://github.com/kubernetes/ingress-nginx/releases
export NGINX_CONTROLLER_VERSION="${nginx-controller-version}"

# =============================================================================
# üìã NOTAS IMPORTANTES Y COMANDOS √öTILES
# =============================================================================
# 
# üîí SEGURIDAD:
#    - Los security groups se combinan autom√°ticamente
#    - Se crean roles IAM con permisos m√≠nimos necesarios
#    - Los certificados ACM proporcionan cifrado TLS
#
# üí∞ COSTOS:
#    - Network Load Balancer: ~$16-45/mes
#    - Application Load Balancer: ~$16-22/mes  
#    - Data Processing: $0.006-0.008 por GB
#    - t3.xlarge: ~$0.1664/hora (~$120/mes por nodo)

#
# üìä L√çMITES AWS:
#    - M√°ximo 50 Load Balancers por regi√≥n
#    - M√°ximo 1000 Target Groups por regi√≥n
#    - Verificar l√≠mites en AWS Service Quotas
#
# üîß TROUBLESHOOTING:
#    - Ejecutar ./verify-installation.sh para diagn√≥sticos
#    - Revisar logs: kubectl logs -n kube-system deployment/aws-load-balancer-controller
#    - Verificar eventos: kubectl get events --sort-by='.lastTimestamp'
#
# üí° COMANDOS √öTILES:
#    - Obtener Account ID: aws sts get-caller-identity --query Account --output text
#    - Obtener VPC ID: aws eks describe-cluster --name CLUSTER_NAME --query cluster.resourcesVpcConfig.vpcId
#    - Listar subnets: aws ec2 describe-subnets --filters "Name=vpc-id,Values=VPC_ID" --query 'Subnets[*].[SubnetId,AvailabilityZone,MapPublicIpOnLaunch]'
#    - Listar certificados: aws acm list-certificates --region REGION
#    - Verificar perfiles: aws configure list-profiles
#
# =============================================================================
